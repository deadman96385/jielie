# q32s

Seems to be a (over)simplified variant of pi32v2, which even lacks some features of pi32..

- ELF machine ID: 0xF2 (242)
- Little endian
- 32-bit architecture

## Details

### General purpose registers (GPRs)

16 general purpose registers, `r0` through `r15`.

Unlike pi32v2, there is no doubled registers, as well as any associated operations
(like the multiply-accumulate stuff, etc.)

### Special function registers (SFRs)

| Number | Name  |          Description          |
|--------|-------|-------------------------------|
| sr0    | reti  | Interrupt return address      |
| sr1    | rete  | Emulation return address      |
| sr2    | retx  | eXception return address      |
| sr3    | rets  | Subroutine return address     |
| sr4    |       |                               |
| sr5    | psr   | Processor status register     |
| sr6    | cnum  |                               |
| sr7    |       |                               |
| sr8    |       |                               |
| sr9    |       |                               |
| sr10   |       |                               |
| sr11   | icfg  | Interrupt config              |
| sr12   | usp   | User mode stack pointer       |
| sr13   | ssp   | Supervisor mode stack pointer |
| sr14   | sp    | Stack pointer                 |
| sr15   | pc    | Program counter               |

## Opcodes

### 16-bit

```
000000000000000-		nop
000000000000001-		idle
000000000000010-		bkpt
000000000000011-		hbkpt
000000000000100-		csync
000000000000101-		ssync
000000000000110-		syscall
00000000000100--		lockclr
00000000000101--		lockset
00000000000110--		cli
00000000000111--		sti
000000000010000-		rts
000000000010001-		rti
000000000010010-		rtx
000000000010011-		rte

0000000000101Xxx		swi `Xxx`

00000000001100--		pc = [sp++]
00000000001101--		[--sp] = rets

000000000011100-		cc = 0
000000000011101-		cc = 1

0000000000111100		sp = usp
0000000000111101		sp = ssp
0000000000111110		usp = sp
0000000000111111		ssp = sp

00000000010-Xxxx		testset b[r`Xxxx`]

000000000110Xxxx		cli r`Xxxx`
000000000111Xxxx		sti r`Xxxx`
000000001000Xxxx		call r`Xxxx`
000000001001Xxxx		goto r`Xxxx`
000000001010Xxxx		tbb [r`Xxxx`]
000000001011Xxxx		tbh [r`Xxxx`]
000000001100Xxxx		pfetch [r`Xxxx`]
000000001101Xxxx		iflush [r`Xxxx`]
000000001110Xxxx		flush [r`Xxxx`]
000000001111Xxxx		flushinv [r`Xxxx`]

0000000100000000		{r3-r0} = [sp++]
....

0000001Aaaaa0Xxx		r`Xxx` = [sp + `Aaaaa00`]
0000001Aaaaa1Xxx		[sp + `Aaaaa00`] = r`Xxx`

000001000000Xxxx		r`Xxxx` = r`Yyy`.b0 (u)
000001000001Xxxx		r`Xxxx` = r`Yyy`.b0 (s)
0000010Yyy10Xxxx		r`Xxxx` = r`Yyy`.l (u)
0000010Yyy11Xxxx		r`Xxxx` = r`Yyy`.l (s)
0000011AaaaaXxxx		r`Xxxx` = s`1Aaaaa`
00001000YyyyXxxx		r`Xxxx` = r`Yyyy`
00001001YyyyXxxx		r`Xxxx` += r`Yyyy`
00001010Aaaaaaa-		sp += s`Aaaaaaa00`
0000110Yyy00Xxxx		r`Xxxx` <<= r`Yyy`
0000110Yyy01Xxxx		r`Xxxx` <<<= r`Yyy`
0000110Yyy10Xxxx		r`Xxxx` >>= r`Yyy`
0000110Yyy11Xxxx		r`Xxxx` >>>= r`Yyy`
0000111ZzzYyyXxx		r`Xxx` = r`Yyy` * r`Zzz`

00010Aaaaaaaaaaa		call s`Aaaaaaaaaaa0`
00011Aaaaaaaaaaa		goto s`Aaaaaaaaaaa0`

0010XxxAaaaaaaaa		if (r`Xxx` == 0) goto s`Aaaaaaaaa0`
0011XxxAaaaaaaaa		if (r`Xxx` != 0) goto s`Aaaaaaaaa0`

0100YyyAaaaa0Xxx		r`Xxx` = [r`Yyy` + `Aaaaa00`]
0100YyyAaaaa1Xxx		[r`Yyy` + `Aaaaa00`] = r`Xxx`

0101YyyAaaaa0Xxx		r`Xxx` = h[r`Yyy` + `Aaaaa0`] (u)
0101YyyAaaaa1Xxx		h[r`Yyy` + `Aaaaa0`] = r`Xxx`

0110YyyAaaaa0Xxx		r`Xxx` = b[r`Yyy` + `Aaaaa`] (u)
0110YyyAaaaa1Xxx		b[r`Yyy` + `Aaaaa`] = r`Xxx`

0111AaaaaaaaXxxx		r`Xxxx` = `Aaaaaaaa`

1000AaaaaaaaXxxx		r`Xxxx` += s`Aaaaaaaa`
1001YyyAaaaaXxxx		r`Xxxx` = r`Yyy` + `Aaaaa`

1010AaaaaaaaXxxx		r`Xxxx` = sp + `Aaaaaaaa`
1011ZzzYyy00Xxxx		r`Xxxx` = r`Zzz` + r`Yyy`
1011Sssss001Xxxx		r`Xxxx` |= `(1<<'Sssss')`
1011Sssss101Xxxx		r`Xxxx` |= r0
1011ZzzYyy10Xxxx		r`Xxxx` = r`Zzz` - r`Yyy`
1011Sssss011Xxxx		r`Xxxx` ^= `(1<<'Sssss')`
1011Sssss111Xxxx		r`Xxxx` &= `~(1<<'Sssss')`

11000SssssYyyXxx		r`Xxx` = r`Yyy` << `Sssss`<0==32>
11001SssssYyyXxx		r`Xxx` = r`Yyy` <<< `Sssss`<0==32>
11010SssssYyyXxx		r`Xxx` = r`Yyy` >> `Sssss`<0==32>
11011SssssYyyXxx		r`Xxx` = r`Yyy` >>> `Sssss`<0==32>

```

### 32-bit

```

1110AaaaaaaaXxxx|0000000000000000	???	if (r`Xxxx` == s`Aaaaaaaa`) goto 0

11110000YyyyXxxx|0000000000000000	???	if ((r`Xxxx` & r`Yyyy`) == 0) goto 0
11110001YyyyXxxx|0000000000000000	???	if ((r`Xxxx` & r`Yyyy`) != 0) goto 0
11110010YyyyXxxx|0000000000000000	???	if (r`Xxxx` == r`Yyyy`) goto 0
11110011000Sssss|0000000000000000	???	if ((r0 & `(1<<'Sssss')`) == 0) goto 0
11110011001Sssss|0000000000000000	???	if ((r0 & `(1<<'Sssss')`) != 0) goto 0
1111001101000000|0000000000000000	???	ifeq goto 0
1111001101000001|0000000000000000	???	ifne goto 0
1111001101000010|0000000000000000	???	ifcs goto 0
1111001101000011|0000000000000000	???	ifcc goto 0
1111001101000100|0000000000000000	???	ifmi goto 0
1111001101000101|0000000000000000	???	ifpl goto 0
1111001101000110|0000000000000000	???	ifvs goto 0
1111001101000111|0000000000000000	???	ifvc goto 0
1111001101001000|0000000000000000	???	ifhi goto 0
1111001101001001|0000000000000000	???	ifls goto 0
1111001101001010|0000000000000000	???	ifge goto 0
1111001101001011|0000000000000000	???	iflt goto 0
1111001101001100|0000000000000000	???	ifgt goto 0
1111001101001101|0000000000000000	???	ifle goto 0
1111001101001110|0000000000000000	///	<crash!>
1111001101001111|0000000000000000	///	<crash!>
111100110101Xxxx|0000000000000000	???	if (--r`Xxxx` != 0) goto 0

111100110110----|0000000000000000	?.?	trigger

11110011011100-0|PONMLKJIHGFEDCBA		{`PONMLKJIHGFEDCBA`<r15-r0>} = [sp++]
11110011011100-1|PONMLKJIHGFEDCBA		{rets, `PONMLKJIHGFEDCBA`<r15-r0>} = [sp++]
11110011011101-1|PONMLKJIHGFEDCBA		{pc, `PONMLKJIHGFEDCBA`<r15-r0>} = [sp++]

11110011011110-0|PONMLKJIHGFEDCBA		[--sp] = {`PONMLKJIHGFEDCBA`<r15-r0>}
11110011011110-1|PONMLKJIHGFEDCBA		[--sp] = {rets, `PONMLKJIHGFEDCBA`<r15-r0>}

111100110111110-|PONMLKJIHGFEDCBA		{`PONMLKJIHGFEDCBA`<sr15-0>} = [sp++]
111100110111111-|PONMLKJIHGFEDCBA		[--sp] = {`PONMLKJIHGFEDCBA`<sr15-0>} = [sp++]

1111001110Aaaaaaaaaaaaaaaaaaaaaa		call s`Aaaaaaaaaaaaaaaaaaaaaa0`
1111001111Aaaaaaaaaaaaaaaaaaaaaa		goto s`Aaaaaaaaaaaaaaaaaaaaaa0`

1111010000Aaaaaa|0000000000000000	???	[r0 + s`Aaaaaa00`] |= 2048
1111010001Aaaaaa|0000000000000000	???	[r0 + s`Aaaaaa00`] ^= 2048
1111010010Aaaaaa|0000000000000000	???	[r0 + s`Aaaaaa00`] &= 2048
1111010011Aaaaaa|0000000000000000	???	[r0 + s`Aaaaaa00`] = 2048

111101010--0Xxxx|0000000000000000	???	r`Xxxx` = [sp]
111101010--1Xxxx|0000000000000000	???	[sp] = r`Xxxx`

111101011000Xxxx|0000000000000000	???	r`Xxxx` = h[sp] (u)
111101011001Xxxx|0000000000000000	???	h[sp] = r`Xxxx`
111101011010Xxxx|0000000000000000	???	r`Xxxx` = h[sp] (s)

111101011100Xxxx|0000000000000000	???	r`Xxxx` = b[sp] (u)
111101011101Xxxx|0000000000000000	???	b[sp] = r`Xxxx`
111101011110Xxxx|0000000000000000	???	r`Xxxx` = b[sp] (s)

1111011000-0Xxxx|0000000000000000	???	r`Xxxx` = [r0 + 0]
1111011000-1Xxxx|0000000000000000	???	[r0 + 0] = r`Xxxx`

1111011001-0Xxxx|0000000000000000	???	r`Xxxx` = [r0 ++= 0]
1111011001-1Xxxx|0000000000000000	???	[r0 ++= 0] = r`Xxxx`

111101101000Xxxx|0000000000000000	???	r`Xxxx` = [r0+r0]
111101101001Xxxx|0000000000000000	???	[r0+r0] = r`Xxxx`

111101101010Xxxx|0000000000000000	???	r`Xxxx` = [r0+r0<<2]
111101101011Xxxx|0000000000000000	???	[r0+r0<<2] = r`Xxxx`

1111011011-0Xxxx|0000000000000000	???	r`Xxxx` = [r0 ++= r0]
1111011011-1Xxxx|0000000000000000	???	[r0 ++= r0] = r`Xxxx`

111101110-00Xxxx|0000000000000000	???	r`Xxxx` = h[r0 + 0] (u)
111101110-01Xxxx|0000000000000000	???	h[r0 + 0] = r`Xxxx`
111101110-10Xxxx|0000000000000000	???	r`Xxxx` = h[r0 + 0] (s)

111101111-00Xxxx|0000000000000000	???	r`Xxxx` = h[r0 ++= 0] (u)
111101111-01Xxxx|0000000000000000	???	h[r0 ++= 0] = r`Xxxx`
111101111-10Xxxx|0000000000000000	???	r`Xxxx` = h[r0 ++= 0] (s)

111110000000Xxxx|0000000000000000	???	r`Xxxx` = h[r0+r0] (u)
111110000001Xxxx|0000000000000000	???	h[r0+r0] = r`Xxxx`
111110000010Xxxx|0000000000000000	???	r`Xxxx` = h[r0+r0] (s)

111110000100Xxxx|0000000000000000	???	r`Xxxx` = h[r0+r0<<1] (u)
111110000101Xxxx|0000000000000000	???	h[r0+r0<<1] = r`Xxxx`
111110000110Xxxx|0000000000000000	???	r`Xxxx` = h[r0+r0<<1] (s)

111110001-00Xxxx|0000000000000000	???	r`Xxxx` = h[r0 ++= r0] (u)
111110001-01Xxxx|0000000000000000	???	h[r0 ++= r0] = r`Xxxx`
111110001-10Xxxx|0000000000000000	???	r`Xxxx` = h[r0 ++= r0] (s)

11111011000-Xxxx|0000000000000000	???	r`Xxxx` = 0
1111101100100---|0000000000000000	???	r0 = 2048
1111101100101--0|0000000000000000	???	r0 = reti
1111101100101--1|0000000000000000	???	reti = r0

111110110011--00|0000000000000000	???	r0 = rev8(r0)
111110110011--01|0000000000000000	???	r0 = rev16(r0)
111110110011--10|0000000000000000	???	r0 = revs(r0.l)

111110110100Xxxx|0000000000000000	???	r`Xxxx` = r0 + 2048
111110110101Xxxx|0000000000000000	???	r`Xxxx` = r0 - 2048
11111011011-Xxxx|0000000000000000	???	r`Xxxx` = 2048 - r0
111110111000----|0000000000000000	???	r0 = r0 + r0
111110111001----|0000000000000000	???	r0 = r0 - r0
111110111010----|0000000000000000	???	r0 = r0 + r0 + c
111110111011----|0000000000000000	???	r0 = r0 - r0 - !c
11111011110-----|0000000000000000	???	sp += 0
11111011111-Xxxx|0000000000000000	???	r`Xxxx` = sp + 0

11111100YyyyXxxx|0000000000000000	???	r`Xxxx` = r`Yyyy` + 0

111111010000Xxxx|0000000000000000	???	r`Xxxx` = r0 | 2048
111111010001Xxxx|0000000000000000	???	r`Xxxx` = r0 ^ 2048
111111010010Xxxx|0000000000000000	???	r`Xxxx` = r0 & 2048
111111010011Xxxx|0000000000000000	???	r`Xxxx` = r0 & 4294965247

11111101010-----|0000000000000000	???	r0 = uextra(r0, p:r0[12:8], l:r0[4:0])
11111101011-----|0000000000000000	???	r0 = sextra(r0, p:r0[12:8], l:r0[4:0])
11111101100Aaaaa|0000000000000000	???	r0 = uextra(r0, p:0, l:`Aaaaa`)
11111101101Aaaaa|0000000000000000	???	r0 = sextra(r0, p:0, l:`Aaaaa`)
11111101110Aaaaa|0000000000000000	???	r0 <= insert(r0, p:0, l:`Aaaaa`)

1111110111100000|0000000000000000	???	r0 = r0 | r0
1111110111100001|0000000000000000	???	r0 = r0 ^ r0
1111110111100010|0000000000000000	???	r0 = r0 & r0
1111110111100011|0000000000000000	???	r0 = r0 & ~r0
1111110111100100|0000000000000000	???	r0 = r0.b0 (u)
1111110111100101|0000000000000000	???	r0 = r0.b0 (s)
1111110111100110|0000000000000000	???	r0 = r0.l (u)
1111110111100111|0000000000000000	???	r0 = r0.l (s)
1111110111101000|0000000000000000	???	r0 = clz(r0)
1111110111101001|0000000000000000	???	r0 = cls(r0)
1111110111101010|0000000000000000	???	r0 = zcmp(r0)
11111101111011--|0000000000000000	???	r0 <= insert(r0, p:r0[12:8], l:r0[4:0])

1111110111110000|0000000000000000	???	r0 = r0 << 32
1111110111110001|0000000000000000	???	r0 = r0 <<< 32
1111110111110010|0000000000000000	???	r0 = r0 >> 32
1111110111110011|0000000000000000	???	r0 = r0 >>> 32
111111011111010-|0000000000000000	???	r0 = r0 <> 32
111111011111011-|0000000000000000	???	r0 = r0 <c> 32
1111110111111000|0000000000000000	???	r0 = r0 << r0
1111110111111001|0000000000000000	???	r0 = r0 <<< r0
1111110111111010|0000000000000000	???	r0 = r0 >> r0
1111110111111011|0000000000000000	???	r0 = r0 >>> r0
111111011111110-|0000000000000000	???	r0 = r0 <> r0
111111011111111-|0000000000000000	???	r0 = r0 <c> r0

1111111000--Xxxx|0000000000000000	???	r`Xxxx` = r0 * 2048
1111111001------|0000000000000000	???	r0 = r0 * r0
1111111010-0----|0000000000000000	???	r0 += r0 * r0
1111111010-1----|0000000000000000	???	r0 -= r0 * r0
111111101100----|0000000000000000	???	r0 = r0 / r0 (u)
111111101101----|0000000000000000	???	r0 = r0 % r0 (u)
111111101110----|0000000000000000	???	r0 = r0 / r0 (s)
111111101111----|0000000000000000	???	r0 = r0 % r0 (s)

```

### 48-bit

```

11111111000-0000|0000000000000000|0000000000000000	???	if (r0 == 0) goto 0
11111111000-0001|0000000000000000|0000000000000000	???	if (r0 != 0) goto 0
11111111000-0010|0000000000000000|0000000000000000	???	if (r0 >= 0) goto 0
11111111000-0011
11111111000-0100
11111111000-0101
11111111000-0110
11111111000-0111
11111111000-1000
11111111000-1001
11111111000-1010
11111111000-1011
11111111000-1100
11111111000-1101
11111111000-1110
11111111000-1111
         /\
         00
         01
         10

11111111011----0|0000000000000000|0000000000000000	???	if ((r0 & 2048) == 0) goto 0
11111111011----1|0000000000000000|0000000000000000	???	if ((r0 & 2048) != 0) goto 0

1111111110------|Aaaaaaaaaaaaaaaa|aaaaaaaaaaaaaaaa		call s`Aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa`

11111111110-Xxxx|Aaaaaaaaaaaaaaaa|aaaaaaaaaaaaaaaa		r`Xxxx` = `Aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa`
11111111111-Xxxx|Aaaaaaaaaaaaaaaa|aaaaaaaaaaaaaaaa		sr`Xxxx` = `Aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa`

```
