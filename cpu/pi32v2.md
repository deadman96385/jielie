# pi32v2

Enhanced version of the [pi32](pi32.md) architecture.

- ELF machine ID: 0xF1 (241)
- Little endian
- 32-bit architecture

## Details

### General purpose registers (GPRs)

16 general purpose registers, `r0` through `r15`.

Unlike pi32, the stack pointer (`sp`) now got is own SFR, so the `r15` is now free for general usage.

There are also paired registers (`r0_r1`, `r2_r3`, ... `r14_r15`), which hold 64-bits!

### Special function registers (SFRs)

| Number | Name  |          Description          |
|--------|-------|-------------------------------|
| sr0    | reti  | Interrupt return address      |
| sr1    | rete  | Exception return address      |
| sr2    | retx  | X return address              |
| sr3    | rets  | Subroutine return address     |
| sr4    |       |                               |
| sr5    | psr   | Processor status register     |
| sr6    | cnum  |                               |
| sr7    |       |                               |
| sr8    |       |                               |
| sr9    |       |                               |
| sr10   |       |                               |
| sr11   | icfg  | Interrupt config              |
| sr12   | usp   | User mode stack pointer       |
| sr13   | ssp   | Supervisor mode stack pointer |
| sr14   | sp    | Stack pointer                 |
| sr15   | pc    | Program counter               |

## Instructions

```
0000000000000000		nop
0000000000000001		idle
0000000000000010		bkpt
0000000000000011		hbkpt
0000000000100000		csync
0000000000100001		syscall
00000000001---10		ssync
00000000001---11		btbclr
0000000001000000		lockclr
0000000001000001		lockset
0000000001100000		cli
0000000001100001		sti
0000000010000000		rts
0000000010000001		rti
0000000010000010		rtx
0000000010000011		rte
000000001010-Xxx		swi `Xxx`
000000001011Xxxx		testset b[r`Xxxx`]
000000001100Xxxx		call r`Xxxx`
000000001101Xxxx		goto r`Xxxx`
000000001110Xxxx		cli r`Xxxx`
000000001111Xxxx		sti r`Xxxx`
000000010000Xxxx		tbb r`Xxxx`
000000010001Xxxx		tbh r`Xxxx`
000000100000Xxxx		pfetch [r`Xxxx`]
000000100001Xxxx		iflush [r`Xxxx`]
000000100010Xxxx		flush [r`Xxxx`]
000000100011Xxxx		flushinv [r`Xxxx`]

00000011YyyyXxxx		rep `Yyyy0`<+1>, r`Xxxx`   { <`Yyyy0`+1 instruction words > }

0000010000000000		pc = [sp++]
0000010000010000		[--sp] = rets

0000010000110000		{rets, r3-r0} = [sp++]
0000010000110001		{rets, r3-r1} = [sp++]
0000010000110010		{rets, r3, r2} = [sp++]
0000010000110011		{rets, r3} = [sp++]
0000010000110100		{rets, r4} = [sp++]
0000010000110101		{rets, r5, r4} = [sp++]
0000010000110110		{rets, r6-r4} = [sp++]
0000010000110111		{rets, r7-r4} = [sp++]
0000010000111000		{rets, r8-r4} = [sp++]
0000010000111001		{rets, r9-r4} = [sp++]
0000010000111010		{rets, r10-r4} = [sp++]
0000010000111011		{rets, r11-r4} = [sp++]
0000010000111100		{rets, r12-r4} = [sp++]
0000010000111101		{rets, r13-r4} = [sp++]
0000010000111110		{rets, r14-r4} = [sp++]
0000010000111111		{rets, r15-r4} = [sp++]

0000010001000000		{r3-r0} = [sp++]
0000010001000001		{r3-r1} = [sp++]
0000010001000010		{r3, r2} = [sp++]
0000010001000011		{r3} = [sp++]
0000010001000100		{r4} = [sp++]
0000010001000101		{r5, r4} = [sp++]
0000010001000110		{r6-r4} = [sp++]
0000010001000111		{r7-r4} = [sp++]
0000010001001000		{r8-r4} = [sp++]
0000010001001001		{r9-r4} = [sp++]
0000010001001010		{r10-r4} = [sp++]
0000010001001011		{r11-r4} = [sp++]
0000010001001100		{r12-r4} = [sp++]
0000010001001101		{r13-r4} = [sp++]
0000010001001110		{r14-r4} = [sp++]
0000010001001111		{r15-r4} = [sp++]

0000010001010000		{pc, r3-r0} = [sp++]
0000010001010001		{pc, r3-r1} = [sp++]
0000010001010010		{pc, r3, r2} = [sp++]
0000010001010011		{pc, r3} = [sp++]
0000010001010100		{pc, r4} = [sp++]
0000010001010101		{pc, r5, r4} = [sp++]
0000010001010110		{pc, r6-r4} = [sp++]
0000010001010111		{pc, r7-r4} = [sp++]
0000010001011000		{pc, r8-r4} = [sp++]
0000010001011001		{pc, r9-r4} = [sp++]
0000010001011010		{pc, r10-r4} = [sp++]
0000010001011011		{pc, r11-r4} = [sp++]
0000010001011100		{pc, r12-r4} = [sp++]
0000010001011101		{pc, r13-r4} = [sp++]
0000010001011110		{pc, r14-r4} = [sp++]
0000010001011111		{pc, r15-r4} = [sp++]

0000010001100000		[--sp] = {rets, r3-r0}
0000010001100001		[--sp] = {rets, r3-r1}
0000010001100010		[--sp] = {rets, r3, r2}
0000010001100011		[--sp] = {rets, r3}
0000010001100100		[--sp] = {rets, r4}
0000010001100101		[--sp] = {rets, r5, r4}
0000010001100110		[--sp] = {rets, r6-r4}
0000010001100111		[--sp] = {rets, r7-r4}
0000010001101000		[--sp] = {rets, r8-r4}
0000010001101001		[--sp] = {rets, r9-r4}
0000010001101010		[--sp] = {rets, r10-r4}
0000010001101011		[--sp] = {rets, r11-r4}
0000010001101100		[--sp] = {rets, r12-r4}
0000010001101101		[--sp] = {rets, r13-r4}
0000010001101110		[--sp] = {rets, r14-r4}
0000010001101111		[--sp] = {rets, r15-r4}

0000010001110000		[--sp] = {r3-r0}
0000010001110001		[--sp] = {r3-r1}
0000010001110010		[--sp] = {r3, r2}
0000010001110011		[--sp] = {r3}
0000010001110100		[--sp] = {r4}
0000010001110101		[--sp] = {r5, r4}
0000010001110110		[--sp] = {r6-r4}
0000010001110111		[--sp] = {r7-r4}
0000010001111000		[--sp] = {r8-r4}
0000010001111001		[--sp] = {r9-r4}
0000010001111010		[--sp] = {r10-r4}
0000010001111011		[--sp] = {r11-r4}
0000010001111100		[--sp] = {r12-r4}
0000010001111101		[--sp] = {r13-r4}
0000010001111110		[--sp] = {r14-r4}
0000010001111111		[--sp] = {r15-r4}

0000010010FEDCBA		{sr`ABCDEF` <sr0-sr5>} = [sp++]
0000010011FEDCBA		[--sp] = {sr`ABCDEF` <sr0-sr5>}

000001010YyySXxx		r`Xxx` = [r`Yyy`++=s`S100`]
000001011YyySXxx		[r`Yyy`++=s`S100`] = r`Xxx`

000001100YyySXxx		r`Xxx` = h[r`Yyy`++=s`S10`] (u)
000001101YyySXxx		h[r`Yyy`++=s`S10`] = r`Xxx`

000001110YyySXxx		r`Xxx` = b[r`Yyy`++=s`S1`] (u)
000001111YyySXxx		b[r`Yyy`++=s`S1`] = r`Xxx`

000010ZzzYyy0Xxx		r`Xxx` = [r`Yyy`++=r`1Zzz`]
000010ZzzYyy1Xxx		[r`Yyy`++=r`1Zzz`] = r`Xxx`

000011ZzzYyy0Xxx		r`Xxx` = h[r`Yyy`++=r`1Zzz`] (u)
000011ZzzYyy1Xxx		h[r`Yyy`++=r`1Zzz`] = r`Xxx`

000100ZzzYyy0Xxx		r`Xxx` = b[r`Yyy`++=r`1Zzz`] (u)
000100ZzzYyy1Xxx		b[r`Yyy`++=r`1Zzz`] = r`Xxx`

000101000000000X		cc = `X`

0001010001000000		sp = usp
0001010001000001		sp = ssp
0001010001000010		usp = sp
0001010001000011		ssp = sp

000101001000Xxx0		r`Xxx1`_r`Xxx0` = 0
0001010011000Xxx		r`1Xxx` = 0
00010101Yyy0Xxx0		r`Xxx1`_r`Xxx0` = r`Yyy1`_r`Yyy0`
00010110YyyyXxxx		r`Xxxx` = r`Yyyy`
000101110Yyy0Xxx		r`Xxx` = r`Yyy`.b0 (u)
000101110Yyy1Xxx		r`Xxx` = r`Yyy`.b0 (s)
000101111Yyy0Xxx		r`Xxx` = r`Yyy`.l (u)
000101111Yyy1Xxx		r`Xxx` = r`Yyy`.l (s)
00011000YyyyXxxx		r`Xxxx` += r`Yyyy`
000110010Yyy0Xxx		r`Xxx` |= r`Yyy`
000110010Yyy1Xxx		r`Xxx` ^= r`Yyy`
000110011Yyy0Xxx		r`Xxx` = ~r`Yyy`
000110011Yyy1Xxx		r`Xxx` &= r`Yyy`
000110100Yyy0Xxx		r`Xxx` <<= r`Yyy`
000110100Yyy1Xxx		r`Xxx` <<<= r`Yyy`
000110101Yyy0Xxx		r`Xxx` >>= r`Yyy`
000110101Yyy1Xxx		r`Xxx` >>>= r`Yyy`
00011011YyyyXxxx		r`Xxxx` *= r`Yyyy`
0001110ZzYyyAXxx		r`Xxx` = r`Yyy` + r`ZzA`
0001111ZzYyyAXxx		r`Xxx` = r`Yyy` - r`ZzA`

------------------------------------------------------------------------------------------

001000000000Xxxx		r`Xxxx` = [sp]
0010000000010Xxx		r`Xxx` = -32
001000000010Xxxx		r`Xxxx` = [sp+128]
0010000000110Xxx		r`Xxx` |= 1
0010000000111Xxx		r`Xxx` ^= 1
0010000001AaaXxx		r`Xxx` = `Aaa00000`
001000001000Xxxx		[sp] = r`Xxxx`
001000001010Xxxx		r`Xxxx` = [sp]

------------------------------------------------------------------------------------------

111111111100Xxxx Aaaaaaaaaaaaaaaa Bbbbbbbbbbbbbbbb		r`Xxxx` = `BbbbbbbbbbbbbbbbAaaaaaaaaaaaaaaa`
111111111110Xxxx Aaaaaaaaaaaaaaaa Bbbbbbbbbbbbbbbb		sr`Xxxx` = `BbbbbbbbbbbbbbbbAaaaaaaaaaaaaaaa`
```
